<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Habib Algorithm</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    />

    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        width: 100%;
        top: 0;
        bottom: 0;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
    <script src="../qgis/polygon.geojson" type="text/javascript"></script>
    <script src="utils.js"></script>
    <script>
      // create Leaflet map, centered on Texas
      var map = L.map("map", {
        // zoomSnap: .1,
        // center: [-84.46,37.98],
        center: [35, 0],
        zoom: 3,
        // crs: L.CRS.EPSG3857,
        crs: L.CRS.Simple,
      });

      var polygon = L.geoJSON(polygonLayer).addTo(map);
      console.log("polygon: ", polygon);
      // debugger;
      const labelLayer = L.featureGroup().addTo(map);
      // add labels to each vertex of the polygon
      polygon
        .getLayers()[0]
        .getLatLngs()[0]
        .forEach((latLng, index) => {
          const label = L.tooltip({
            direction: "auto",
          })
            .setLatLng(latLng)
            .setContent(`<span>${numberToCapitalLetter(index + 1)}</span>`)
            .addTo(labelLayer);
          // Apply styling to label if needed
        });

      // let points = polygon.getLayers()[0].getLatLngs()[0];

      let points = polygonLayer.features[0].geometry.coordinates[0];
      const selectedPoint = points[0];
      const requiredArea = 150;

      // Habib One Point and Area Algorithm
      for (let i = 2; i < points.length; i++) {
        if (calcPolygonAreaShoelace(points.slice(0, i)) >= requiredArea) {
          const LVertex = points[i - 2];
          const NVertex = points[i - 1];
          const areaDiff =
            requiredArea - calcPolygonAreaShoelace(points.slice(0, i-1));
          console.log("areaDiff: ", areaDiff);
          console.log("c", distance(LVertex, selectedPoint));
          console.log("selectedPoint: ", selectedPoint);
          console.log("LVertex: ", LVertex);
          const pDist =
            (2 * areaDiff) /
            (distance(LVertex, selectedPoint) *
              Math.sin(anticlockwiseAngle2D(NVertex, LVertex, selectedPoint)*Math.PI/180));
          const pNewLatLng = [
            LVertex[0] +
              ((NVertex[0] - LVertex[0]) * pDist) / distance(NVertex, LVertex),
            LVertex[1] +
              ((NVertex[1] - LVertex[1]) * pDist) / distance(NVertex, LVertex),
          ];
          console.log("pDist: ", pDist);
          console.log("pNewLatLng: ", pNewLatLng);
          let newPolygon = points.slice(0, i - 1);
          // newPolygon.push({lat:pNewLatLng[0],lng:pNewLatLng[1]});
          newPolygon.push(pNewLatLng);
          L.polygon(L.GeoJSON.coordsToLatLngs(newPolygon), {
            color: "red",
          }).addTo(map);
          // debugger;
          break;
        }
        console.log(i, calcPolygonAreaShoelace(points.slice(0, i)));
      }
    </script>
  </body>
</html>
